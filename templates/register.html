{% extends "base.html" %}
{% block title %}KayÄ±t Ol{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-10">
    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="card-title mb-4">KayÄ±t Formu</h2>
        <form method="POST">
          <!-- Temel KullanÄ±cÄ± Bilgileri -->
          <div class="mb-3">
            <label class="form-label">KullanÄ±cÄ± AdÄ±</label>
            <input type="text" class="form-control" name="username" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" name="email" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Åifre</label>
            <input type="password" class="form-control" name="password" required>
            <small class="text-muted">Åifre 8 karakter ve en az 1 bÃ¼yÃ¼k harf, 1 kÃ¼Ã§Ã¼k harf, 1 rakam iÃ§ermelidir.</small>
          </div>
          
          <!-- Profil Bilgileri -->
          <div class="mb-3">
            <label class="form-label">AdÄ±nÄ±z</label>
            <input type="text" class="form-control" name="name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">BurÃ§</label>
            <select class="form-select" name="zodiac" required>
              <option value="">SeÃ§iniz</option>
              <option value="KoÃ§">KoÃ§</option>
              <option value="BoÄŸa">BoÄŸa</option>
              <option value="Ä°kizler">Ä°kizler</option>
              <option value="YengeÃ§">YengeÃ§</option>
              <option value="Aslan">Aslan</option>
              <option value="BaÅŸak">BaÅŸak</option>
              <option value="Terazi">Terazi</option>
              <option value="Akrep">Akrep</option>
              <option value="Yay">Yay</option>
              <option value="OÄŸlak">OÄŸlak</option>
              <option value="Kova">Kova</option>
              <option value="BalÄ±k">BalÄ±k</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">YaÅŸ</label>
            <input type="number" class="form-control" name="age" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Cinsiyet</label>
            <select class="form-select" name="gender" required>
              <option value="">SeÃ§iniz</option>
              <option value="female">KadÄ±n</option>
              <option value="male">Erkek</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Boy (cm)</label>
            <input type="number" step="0.1" class="form-control" name="height" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Kilo (kg)</label>
            <input type="number" step="0.1" class="form-control" name="weight" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Deneyim Seviyesi</label>
            <select class="form-select" name="experience_level" required>
              <option value="">SeÃ§iniz</option>
              <option value="Beginner">Beginner</option>
              <option value="Intermediate">Intermediate</option>
              <option value="Advanced">Advanced</option>
            </select>
          </div>

          <!-- Hedefler (Structured Hedefler) -->
          <div class="mb-3">
			  <label class="form-label">Hedefleriniz</label>
			  <select class="form-select" name="goals" required>
				<option value="">SeÃ§iniz</option>

				<!-- ğŸ”µ SaÄŸlÄ±klÄ± YaÅŸam / Fitness -->
				<option value="SaÄŸlÄ±klÄ± YaÅŸam - BaÅŸlangÄ±Ã§">SaÄŸlÄ±klÄ± YaÅŸam â€“ BaÅŸlangÄ±Ã§</option>
				<option value="SaÄŸlÄ±klÄ± YaÅŸam - Orta">SaÄŸlÄ±klÄ± YaÅŸam â€“ Orta</option>
				<option value="SaÄŸlÄ±klÄ± YaÅŸam - Ä°leri">SaÄŸlÄ±klÄ± YaÅŸam â€“ Ä°leri</option>

				<!-- ğŸŸ¢ Kilo Vermek (2-5 / 5-10 / 10+ kg) -->
				<option value="Kilo Vermek - Hafif">Kilo Vermek â€“ Hafif (â‰ˆ 2-5 kg)</option>
				<option value="Kilo Vermek - Orta">Kilo Vermek â€“ Orta (â‰ˆ 5-10 kg)</option>
				<option value="Kilo Vermek - Ä°leri">Kilo Vermek â€“ Ä°leri (â‰ˆ 10 kg+)</option>

				<!-- ğŸŸ¡ Kas Yapmak -->
				<option value="Kas Yapmak - BaÅŸlangÄ±Ã§">Kas Yapmak â€“ BaÅŸlangÄ±Ã§</option>
				<option value="Kas Yapmak - Orta">Kas Yapmak â€“ Orta</option>
				<option value="Kas Yapmak - Ä°leri">Kas Yapmak â€“ Ä°leri</option>

				<!-- ğŸŸ  DayanÄ±klÄ±lÄ±k ArtÄ±rma -->
				<option value="DayanÄ±klÄ±lÄ±k - BaÅŸlangÄ±Ã§">DayanÄ±klÄ±lÄ±k â€“ BaÅŸlangÄ±Ã§</option>
				<option value="DayanÄ±klÄ±lÄ±k - Orta">DayanÄ±klÄ±lÄ±k â€“ Orta</option>
				<option value="DayanÄ±klÄ±lÄ±k - Ä°leri">DayanÄ±klÄ±lÄ±k â€“ Ä°leri</option>

				<!-- ğŸŸ£ Performans GeliÅŸtirme -->
				<option value="Performans - BaÅŸlangÄ±Ã§">Performans GeliÅŸtirme â€“ BaÅŸlangÄ±Ã§</option>
				<option value="Performans - Orta">Performans GeliÅŸtirme â€“ Orta</option>
				<option value="Performans - Ä°leri">Performans GeliÅŸtirme â€“ Ä°leri</option>

				<!-- ğŸ”´ Profesyonel Sporcu -->
				<option value="Profesyonel Sporcu">Profesyonel Sporcu (Specialized)</option>
			  </select>
		    </div>

          <!-- SaÄŸlÄ±k ve Ek Bilgiler -->
          <h4 class="soru-metni">SaÄŸlÄ±k ve Ek Bilgiler</h4>
          
          <!-- Kronik HastalÄ±klar (Checkbox Listesi) -->
          <div class="mb-3">
            <label class="form-label">Kronik HastalÄ±klar:</label><br>
            <p class="soru-metni">LÃ¼tfen varsa aÅŸaÄŸÄ±daki kronik hastalÄ±k seÃ§eneklerinden uygun olanlarÄ± seÃ§iniz:</p>
            <input type="checkbox" name="chronic_conditions_options" value="Diyabet"> Diyabet<br>
            <input type="checkbox" name="chronic_conditions_options" value="Hipertansiyon"> Hipertansiyon<br>
            <input type="checkbox" name="chronic_conditions_options" value="AstÄ±m"> AstÄ±m<br>
            <input type="checkbox" name="chronic_conditions_options" value="KardiyovaskÃ¼ler"> KardiyovaskÃ¼ler HastalÄ±klar<br>
            <input type="checkbox" name="chronic_conditions_options" value="Kanser"> Kanser<br>
            <input type="checkbox" name="chronic_conditions_options" value="Osteoporoz"> Osteoporoz<br>
            <input type="checkbox" name="chronic_conditions_options" value="Romatoid Artrit"> Romatoid Artrit<br>
            <input type="checkbox" name="chronic_conditions_options" value="Obezite"> Obezite<br>
            <input type="checkbox" name="chronic_conditions_options" value="Depresyon"> Depresyon<br>
            <input type="checkbox" name="chronic_conditions_options" value="Anemi"> Anemi<br>
            <input type="checkbox" name="chronic_conditions_options" value="Tiroid BozukluÄŸu"> Tiroid BozukluÄŸu<br>
            <input type="checkbox" name="chronic_conditions_options" value="Glaukom"> Glaukom<br>
            <input type="checkbox" name="chronic_conditions_options" value="BÃ¶brek HastalÄ±klarÄ±"> BÃ¶brek HastalÄ±klarÄ±<br>
            <input type="checkbox" name="chronic_conditions_options" value="KaraciÄŸer HastalÄ±klarÄ±"> KaraciÄŸer HastalÄ±klarÄ±<br>
            <input type="checkbox" name="chronic_conditions_options" value="Eklem AÄŸrÄ±larÄ±"> Eklem AÄŸrÄ±larÄ±<br>
            <input type="checkbox" name="chronic_conditions_options" value="Ã‡Ã¶lyak"> Ã‡Ã¶lyak<br>
			<input type="checkbox" name="chronic_conditions_options" value="Yok"> Yok<br>
          </div>
          
          <!-- Ameliyat GeÃ§miÅŸi (Dropdown) -->
          <div class="mb-3">
            <label class="form-label">Ameliyat GeÃ§miÅŸi:</label><br>
            <p class="soru-metni">GeÃ§irmiÅŸ olduÄŸunuz ameliyat tÃ¼rÃ¼nÃ¼ seÃ§iniz:</p>
            <select class="form-select" name="surgery_history" required>
              <option value="">SeÃ§iniz</option>
              <option value="Yok">Yok</option>
              <option value="Kalp AmeliyatÄ±">Kalp AmeliyatÄ±</option>
              <option value="Beyin AmeliyatÄ±">Beyin AmeliyatÄ±</option>
              <option value="KarÄ±n AmeliyatÄ±">KarÄ±n AmeliyatÄ±</option>
              <option value="Ortopedik Ameliyatlar">Ortopedik Ameliyatlar</option>
              <option value="Organ Nakli">Organ Nakli</option>
              <option value="GÃ¶z AmeliyatÄ±">GÃ¶z AmeliyatÄ±</option>
              <option value="DiÅŸ AmeliyatÄ±">DiÅŸ AmeliyatÄ±</option>
              <option value="Mide AmeliyatÄ±">Mide AmeliyatÄ±</option>
              <option value="BaÄŸÄ±rsak AmeliyatÄ±">BaÄŸÄ±rsak AmeliyatÄ±</option>
              <option value="DiÄŸer">DiÄŸer</option>
            </select>
          </div>
          
          <!-- Ä°laÃ§ KullanÄ±mÄ± -->
          <div class="mb-3">
            <label class="form-label">DÃ¼zenli Ä°laÃ§ KullanÄ±yor musunuz?</label><br>
            <p class="soru-metni">LÃ¼tfen ilaÃ§ kullanÄ±m durumunuzu seÃ§iniz:</p>
            <input type="radio" name="drug_usage" value="evet" required> Evet  
            <input type="radio" name="drug_usage" value="hayÄ±r" required> HayÄ±r
          </div>
          <div class="mb-3" id="drug_usage_options" style="display:none;">
            <label class="form-label">KullandÄ±ÄŸÄ±nÄ±z Ä°laÃ§lar:</label><br>
            <p class="soru-metni">AÅŸaÄŸÄ±daki ilaÃ§ seÃ§eneklerinden kullandÄ±klarÄ±nÄ±zÄ± iÅŸaretleyiniz:</p>
            <input type="checkbox" name="drug_options" value="AÄŸrÄ± Kesiciler"> AÄŸrÄ± Kesiciler<br>
            <input type="checkbox" name="drug_options" value="Anti-inflamatuar"> Anti-inflamatuar<br>
            <input type="checkbox" name="drug_options" value="Antihipertansifler"> Antihipertansifler<br>
            <input type="checkbox" name="drug_options" value="Beta Blokerler"> Beta Blokerler<br>
            <input type="checkbox" name="drug_options" value="Statinler"> Statinler<br>
            <input type="checkbox" name="drug_options" value="ACE Ä°nhibitÃ¶rleri"> ACE Ä°nhibitÃ¶rleri<br>
            <input type="checkbox" name="drug_options" value="ARB'ler"> ARB'ler<br>
            <input type="checkbox" name="drug_options" value="Diyabet Ä°laÃ§larÄ±"> Diyabet Ä°laÃ§larÄ±<br>
            <input type="checkbox" name="drug_options" value="Kortikosteroidler"> Kortikosteroidler<br>
            <input type="checkbox" name="drug_options" value="Anksiyolitikler"> Anksiyolitikler<br>
            <input type="checkbox" name="drug_options" value="Uyku Ä°laÃ§larÄ±"> Uyku Ä°laÃ§larÄ±<br>
            <input type="checkbox" name="drug_options" value="Kemoterapi"> Kemoterapi<br>
            <input type="checkbox" name="drug_options" value="DiÃ¼retikler"> DiÃ¼retikler<br>
            <input type="checkbox" name="drug_options" value="Antidepresanlar"> Antidepresanlar<br>
            <input type="checkbox" name="drug_options" value="DiÄŸer"> DiÄŸer<br>
          </div>
          
          <!-- Supplement KullanÄ±mÄ± (15 seÃ§enekli) -->
          <div class="mb-3">
            <label class="form-label">Supplement KullanÄ±mÄ±:</label><br>
            <p class="soru-metni">LÃ¼tfen supplement kullanÄ±mÄ±nÄ±za iliÅŸkin seÃ§eneklerden birden fazlasÄ±nÄ± seÃ§ebilirsiniz:</p>
            <input type="checkbox" name="supplement_options" value="Protein Tozu"> Protein Tozu<br>
            <input type="checkbox" name="supplement_options" value="Kreatin"> Kreatin<br>
            <input type="checkbox" name="supplement_options" value="Karbonhidrat"> Karbonhidrat<br>
            <input type="checkbox" name="supplement_options" value="Vitamin D"> Vitamin D<br>
            <input type="checkbox" name="supplement_options" value="Omega-3 BalÄ±k YaÄŸÄ±"> Omega-3 BalÄ±k YaÄŸÄ±<br>
            <input type="checkbox" name="supplement_options" value="Multivitamin"> Multivitamin<br>
            <input type="checkbox" name="supplement_options" value="BCAA"> BCAA<br>
            <input type="checkbox" name="supplement_options" value="Glutamin"> Glutamin<br>
            <input type="checkbox" name="supplement_options" value="Kolajen"> Kolajen<br>
            <input type="checkbox" name="supplement_options" value="Prebiyotikler"> Prebiyotikler<br>
            <input type="checkbox" name="supplement_options" value="Probiotikler"> Probiotikler<br>
            <input type="checkbox" name="supplement_options" value="ZMA"> ZMA<br>
            <input type="checkbox" name="supplement_options" value="Beta-Alanin"> Beta-Alanin<br>
            <input type="checkbox" name="supplement_options" value="HMB"> HMB<br>
            <input type="checkbox" name="supplement_options" value="L-Carnitine"> L-Carnitine<br>
            <input type="checkbox" name="supplement_options" value="Curcumin"> Curcumin<br>
			<input type="checkbox" name="supplement_options" value="Yok"> Yok<br>
          </div>
          
          <!-- GÃ¼nlÃ¼k Su MiktarÄ± (Dropdown, 10 seÃ§enek: 500 ml'den 5 L'e kadar) -->
          <div class="mb-3">
            <label class="form-label">GÃ¼nlÃ¼k Su MiktarÄ±:</label>
            <select class="form-select" name="daily_water_intake" required>
              <option value="">SeÃ§iniz</option>
              <option value="500 ml">500 ml</option>
              <option value="1 L">1 L</option>
              <option value="1.5 L">1.5 L</option>
              <option value="2 L">2 L</option>
              <option value="2.5 L">2.5 L</option>
              <option value="3 L">3 L</option>
              <option value="3.5 L">3.5 L</option>
              <option value="4 L">4 L</option>
              <option value="4.5 L">4.5 L</option>
              <option value="5 L">5 L</option>
            </select>
          </div>
          
          <!-- Åehir / Ä°lÃ§e AlanlarÄ± -->
          <div class="mb-3">
            <label class="form-label">Åehir</label>
            <select class="form-select" name="city" id="city-select" required>
              <option value="">SeÃ§iniz</option>
              {% for city in cities %}
                <option value="{{ city.city_id }}">{{ city.city_name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Ä°lÃ§e</label>
            <select class="form-select" name="district" id="district-select" required>
              <option value="">Ã–nce ÅŸehir seÃ§iniz</option>
            </select>
          </div>

          <button type="submit" class="btn btn-primary w-100">KayÄ±t Ol</button>
          <small class="text-muted d-block mt-3" style="font-size: 0.8em;">* Akademik proje kapsamÄ±nda bilgileriniz alÄ±nacaktÄ±r.</small>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Åehir seÃ§ildiÄŸinde ilÃ§eleri getir
  document.getElementById('city-select').addEventListener('change', function() {
    var cityId = this.value;
    var districtSelect = document.getElementById('district-select');
    districtSelect.innerHTML = '<option value="">YÃ¼kleniyor...</option>';
    if(cityId) {
      fetch('/get_districts/' + cityId)
        .then(response => response.json())
        .then(data => {
          districtSelect.innerHTML = '<option value="">SeÃ§iniz</option>';
          data.districts.forEach(function(district) {
            var option = document.createElement('option');
            option.value = district.district_id;
            option.textContent = district.district_name;
            districtSelect.appendChild(option);
          });
        });
    }
  });

  // Ä°laÃ§ kullanÄ±mÄ±na baÄŸlÄ± seÃ§enek listesini yÃ¶netmek
  var drugUsageRadios = document.getElementsByName('drug_usage');
  drugUsageRadios.forEach(function(radio) {
    radio.addEventListener('change', function() {
      var optionsDiv = document.getElementById('drug_usage_options');
      if(this.value === "evet") {
        optionsDiv.style.display = "block";
      } else {
        optionsDiv.style.display = "none";
      }
    });
  });

  // Form gÃ¶nderilmeden Ã¶nce checkbox gruplarÄ±nÄ±n zorunluluk kontrolÃ¼
  document.querySelector('form').addEventListener('submit', function(e) {
    // Kronik HastalÄ±klar kontrolÃ¼
    var chronic = document.getElementsByName('chronic_conditions_options');
    var chronicChecked = Array.from(chronic).some(cb => cb.checked);
    if (!chronicChecked) {
      e.preventDefault();
      alert('LÃ¼tfen kronik hastalÄ±k seÃ§eneklerinden en az birini seÃ§iniz.');
      return;
    }
    // Supplement KullanÄ±mÄ± kontrolÃ¼
    var supplement = document.getElementsByName('supplement_options');
    var supplementChecked = Array.from(supplement).some(cb => cb.checked);
    if (!supplementChecked) {
      e.preventDefault();
      alert('LÃ¼tfen supplement seÃ§eneklerinden en az birini seÃ§iniz.');
      return;
    }
    // EÄŸer "DÃ¼zenli Ä°laÃ§ KullanÄ±mÄ±" evet seÃ§ili ise ilaÃ§ seÃ§enekleri kontrolÃ¼
    var drugUsage = document.querySelector('input[name="drug_usage"]:checked');
    if (drugUsage && drugUsage.value === 'evet') {
      var drugOptions = document.getElementsByName('drug_options');
      var drugChecked = Array.from(drugOptions).some(cb => cb.checked);
      if (!drugChecked) {
        e.preventDefault();
        alert('LÃ¼tfen kullandÄ±ÄŸÄ±nÄ±z ilaÃ§ seÃ§eneklerinden en az birini seÃ§iniz.');
        return;
      }
    }
  });
  /* ---- "Yok" seÃ§ildiÄŸinde diÄŸerlerini kapat ---- */
  function makeExclusive(groupName){
    const boxes = document.getElementsByName(groupName);
    boxes.forEach(cb=>{
      if(cb.value === "Yok"){
        // "Yok" tÄ±klandÄ± â†’ diÄŸerlerini kapat
        cb.addEventListener('change', ()=>{
          if(cb.checked){
            boxes.forEach(b=>{ if(b!==cb) b.checked=false; });
          }
        });
      }else{
        // DiÄŸer bir kutu tÄ±klandÄ± â†’ "Yok"u kapat
        cb.addEventListener('change', ()=>{
          if(cb.checked){
            boxes.forEach(b=>{
              if(b.value==="Yok") b.checked=false;
            });
          }
        });
      }
    });
  }

  // Kronik hastalÄ±klar ve supplement gruplarÄ± iÃ§in Ã§aÄŸÄ±r
  makeExclusive('chronic_conditions_options');
  makeExclusive('supplement_options');
</script>
{% endblock %}
